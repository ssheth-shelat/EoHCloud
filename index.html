<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Effects of Homelessness</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    #map { height: 600px; width: 100%; }
    .controls { position: absolute; top: 10px; left: 10px; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.3); }
    .controls button { margin: 5px; }
    .legend { position: absolute; bottom: 10px; right: 10px; background: white; padding: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.3); }
    .legend-item { display: flex; align-items: center; margin: 5px 0; }
    .legend-item div { width: 20px; height: 20px; margin-right: 5px; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="controls">
    <button onclick="filterMarkers('all')">Show All</button>
    <button onclick="filterMarkers('Homeless Fires')">Fires</button>
    <button onclick="filterMarkers('Schools')">Schools</button>
    <button onclick="filterMarkers('Mile Markers')">Mile Markers</button>
    <button onclick="filterMarkers('Government Buildings')">Gov Buildings</button>
    <button onclick="filterMarkers('Bus Stations')">Bus Stations</button>
    <button onclick="filterMarkers('Fire Stations')">Fire Stations</button>
    <button onclick="filterMarkers('Police Stations')">Police Stations</button>
    <br>
    <button onclick="filterByTier('Tier 1')">Tier 1</button>
    <button onclick="filterByTier('Tier 2')">Tier 2</button>
    <button onclick="filterByTier('Tier 3')">Tier 3</button>
  </div>
  <div class="legend">
    <h3>Legend</h3>
    <div class="legend-item"><div style="background-color: red;"></div>Encampments</div>
    <div class="legend-item"><div style="background-color: blue;"></div>Schools</div>
    <div class="legend-item"><div style="background-color: green;"></div>Police Stations</div>
    <div class="legend-item"><div style="background-color: orange;"></div>Fires</div>
    <div class="legend-item"><div style="background-color: purple;"></div>Government Buildings</div>
    <div class="legend-item"><div style="background-color: yellow;"></div>Mile Markers</div>
    <div class="legend-item"><div style="background-color: pink;"></div>Fire Stations</div>
    <div class="legend-item"><div style="background-color: cyan;"></div>Bus Stations</div>
  </div>

  <script>
    let map;
    let markers = [];

    // Initialize Google Map
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 38.58, lng: -121.42 }, // Sacramento, CA
        zoom: 10
      });
      loadMarkers();
    }

    // Load markers from JSON
    function loadMarkers() {
      fetch('/api/markers')
        .then(response => {
          if (!response.ok) throw new Error('Sync failed: ' + response.status);
          return response.json();
        })
        .then(data => {
          clearMarkers();
          data.forEach(item => {
            const marker = new google.maps.Marker({
              position: { lat: item.Latitude, lng: item.Longitude },
              map: map,
              title: item.Name,
              icon: getMarkerIcon(item.Category)
            });
            marker.category = item.Category;
            marker.tier = item.Tier;
            markers.push(marker);
          });
        })
        .catch(error => console.error('Error syncing JSON:', error));
    }

    // Get marker icon based on category
    function getMarkerIcon(category) {
      const icons = {
        'Encampment Data': 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
        'Schools': 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png',
        'Police Stations': 'http://maps.google.com/mapfiles/ms/icons/green-dot.png',
        'Homeless Fires': 'http://maps.google.com/mapfiles/ms/icons/orange-dot.png',
        'Government Buildings': 'http://maps.google.com/mapfiles/ms/icons/purple-dot.png',
        'Mile Markers': 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png',
        'Fire Stations': 'http://maps.google.com/mapfiles/ms/icons/pink-dot.png',
        'Bus Stations': 'http://maps.google.com/mapfiles/ms/icons/cyan-dot.png'
      };
      return icons[category] || 'http://maps.google.com/mapfiles/ms/icons/red-dot.png';
    }

    // Clear all markers
    function clearMarkers() {
      markers.forEach(marker => marker.setMap(null));
      markers = [];
    }

    // Filter markers by category
    function filterMarkers(category) {
      markers.forEach(marker => {
        marker.setMap(category === 'all' || marker.category === category ? map : null);
      });
    }

    // Filter markers by tier
    function filterByTier(tier) {
      markers.forEach(marker => {
        marker.setMap(marker.tier === tier ? map : null);
      });
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqIUhTmGOMDrZfPx5p0Y9m247gH0swyPw&callback=initMap"></script>
</body>
</html>
